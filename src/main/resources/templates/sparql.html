<!DOCTYPE html>
<html>
<head th:replace="fragments/head :: head">
    <title>Getting Started: Serving Web Content</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
	<script type="text/javascript">
     var elements = [
     {link: "/home", value: "Home", active:"true"},
     {link: "/data_management", value: "Data management", active: "false"},
     {link: "/SPARQL_endpoint", value: "SPARQL endpoint", active: "false"},
     {link: "/semantic_WFS", value: "Semantic WFS", active: "false"},
     {link: "/metadata_catalogue", value: "Metadata catalogue", active: "false"},
     {link: "/thematic_map", value: "Thematic map", active: "false"},
     {link: "/documentation", value: "Documentation", active: "false"}];
 </script>

 <script type="text/javascript">
    function getQueryText(){

        var a = "YOUR QUERY"
        const queries = {
            schools: 'SELECT ?item ?itemLabel ?latitude ?longitude WHERE {\n  ?item wdt:P31 wd:Q3914.\n  ?item wdt:P17 wd:Q183.\n  ?item p:P625 ?statement . \n  ?statement psv:P625 ?coordinate_node .\n  ?coordinate_node wikibase:geoLatitude ?latitude .\n  ?coordinate_node wikibase:geoLongitude ?longitude .\n  SERVICE wikibase:label {\n    bd:serviceParam wikibase:language "[AUTO_LANGUAGE],de".\n  }\n}\nLIMIT 10',
            hospital: '#SCHOOLS\n SELECT ?item ?itemLabel ?location WHERE {\n?item wdt:P31 wd:Q16917.\n  SERVICE wikibase:label { bd:serviceParam wikibase:language "[AUTO_LANGUAGE],de". }\n  ?item wdt:P17 wd:Q183.\n    OPTIONAL { ?item wdt:P625 ?location. }\n   }\n     LIMIT 20',
            policeStation: 'SPARQL query for police station'
        }
        document.getElementById('enriching').addEventListener('click',() => document.getElementById("sparqlText").value = queries[document.getElementById('enriching').value]);
    }
</script>

<!--Header with the picture, title and Contact-->
<div class="containerfull">
    <a href="http://localhost:8080/home"><img class="pictureOfHeader" src="https://www.verwaltung-innovativ.de/SharedDocs/Bilder/DE/Artikel/GDI_DE_Logo.jpg?__blob=poster&v=2"></a> 
    <span class="titleOfHeader">Linked Data</span>
    <span class="textOfHeader">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Flag_of_the_United_Kingdom_%282-3%29.svg/1024px-Flag_of_the_United_Kingdom_%282-3%29.svg.png" style="width: 32px; margin-right: 13px;">English | <a href="http://localhost:8080/login" style="text-decoration: none; color: #333333;">Login</a> | <a href="http://localhost:8080/contact" style="text-decoration: none; color: #333333">Contact</a><br><br>
        <a href="https://www.gdi-de.org" target="_blank"><img src="/pictures/GDI-DE.jpg" style="width: 250px; float: right;"></a></span>
    </div>

    <header id="header">
        <div th:insert="fragments/nav :: navbar"></div>
        <h1>Linked Data enrichment</h1>
    </header>
    <body onload="getQueryText()">

        <div class="containerfull">
            <div class="containercontent">
                <div class="containerfull">
                    <div style="width: 60%">
                        <span style="font-weight: bold; font-size: 1.5em;">Class to enrich:</span><br>
                        <select name="classToEnrich" id="enriching">
                            <option value="schools">Schule (Q3914)</option>
                            <option value="hospital">Krankenhaus</option>
                            <option value="policeStation">Polizeistation</option>
                            <option value="fireStation">Feuerwache</option>
                            <option value="supermarket">Supermarkt</option>
                        </select>
                        <br><br>

                        <span style="font-weight: bold; font-size: 1.5em;">Limit of the number of the objects:</span><br>
                        <input type="range" id="numberOfObject" name="numberOfObject" min="10" max="100" step="5" class="inputRange">
                        <br><br>

                        <span style="font-weight: bold; font-size: 1.5em;">Area of search:</span><br>
                        <select name="areaOfSearch">
                            <option value="germeinde">Germeinde</option>
                        </select>
                        <br><br>

                            <span style="font-weight: bold; font-size: 1.5em;">Potential error</span>
                            <pre style="margin-right: 30px;">
                                <code th:text="${errorMessage}"></code>
                            </pre> 


                    </div>

                    <div style="float: right;">
                        <form action="#" th:action="@{/enrichment/results}" th:object="${squery}" method="post">
                            <textarea id="sparqlText" rows="16" cols="60" style="font-size: 1.6em; width: 100%; height: 100%; line-height: 150%" th:field="*{results}">YOUR QUERY</textarea><br><input style="margin-left: auto; margin-right: auto; font-size: 1.4em;" type="submit" name="Submit" value="Get the query results">
                        </form>
                        <br><br>
                    </div>
                </div>
                <section> 
                    <div class="tableContentSPARQL">                    
                        <table border="1" style="width: 700px;">
                            <thead>
                                <tr><th colspan="4" style="text-align: center; font-size: 1.2em;">Results of the query</th></tr>
                                <tr style="text-align: center;">
                                    <th><span>item</span></th>
                                    <th><span>itemLabel</span></th>
                                    <th><span>Latitude</span></th>
                                    <th><span>Longitude</span></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="md: ${MDlist}">
                                    <td style="width: 170px;"><span th:text="${md[0]}"></span></td>
                                    <td style="width: 170px;"><span th:text="${md[1]}"></span></td>
                                    <td style="width: 170px;"><span th:text="${md[2]}"></span></td>
                                    <td style="width: 170px;"><span th:text="${md[3]}"></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div id=map  style="position : relative; width: 500px; height: 500px;">
                        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

                        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
                        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
                        crossorigin=""/>

                        <script th:inline="javascript">
                            /*<![CDATA[*/

                            var dataArray = /*[[${MDlist}]]*/ 'default';
                            console.log("type of dataarray : ", typeof dataArray);

                            Object.size = function(obj) {
                              var size = 0,
                              key;
                              for (key in obj) {
                                if (obj.hasOwnProperty(key)) size++;
                            }
                            return size;
                        };
                        var size = Object.size(dataArray);
                        /*]]>*/
                    </script>
                    <script>
                        var query = new L.layerGroup()
                        for(let i = 0; i<size; i++){

                            L.marker([dataArray[i][2],dataArray[i][3]]).bindPopup(dataArray[i][1]).addTo(query);
                        }
                            //MDlist.foreach(element=>console.log(element));
                            /*var cities = new L.layerGroup();

                            L.marker([50.11, 8.68]).bindPopup('Frankfurt').addTo(cities),
                            L.marker([49.99, 8.24]).bindPopup('Mainz').addTo(cities),
                            L.marker([50.07, 8.23]).bindPopup('Wiesbaden').addTo(cities);
                            /*
                            var universities = new L.layerGroup();

                            L.marker([49.997328408298145, 8.27853230401006]).bindPopup('University of Applied Sciences - Mainz').addTo(universities),
                            L.marker([49.993200897757106, 8.241440127816325]).bindPopup('Johannes Gutenberg University of Mainz').addTo(universities),
                            L.marker([49.98676378595688, 8.425170123876455]).bindPopup('RheinMain University - Campus "On Brückweg"').addTo(universities),
                            L.marker([50.132425696149056, 8.691578671069479]).bindPopup('Frankfurt University of Applied Sciences').addTo(universities),
                            L.marker([49.993200897757106, 8.241440127816325]).bindPopup('RheinMain University of Applied Sciences').addTo(universities);
                            */

                            var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
                            'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                            mbUrl = 'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

                            var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox/light-v9', tileSize: 512, zoomOffset: -1, attribution: mbAttr}),
                            streets  = L.tileLayer(mbUrl, {id: 'mapbox/streets-v11', tileSize: 512, zoomOffset: -1, attribution: mbAttr});

                            var map = L.map('map', {
                                center: [49.99, 8.24],
                                zoom: 6,
                                layers: [streets, query]
                            });

                            var baseLayers = {
                                "Grayscale": grayscale,
                                "Streets": streets
                            };

                            var overlays = {
                                "Query" : query
                            };
                            L.control.layers(baseLayers, overlays).addTo(map);
                        </script>
                    </div> 
                </section>

            </div>

            <!--The boxes "Provider" and "Contact"-->
            <div class="containerbox">
                <div class="box">
                    <div class="titlebox">
                        <span> Provider</span>
                    </div>
                    <div class="normalfont">
                        <br><span class="boldfont"> GDI-DE Geodateninfrastruktur Deutschland</span>
                        <span><a href="https://www.gdi-de.org/" target="_blank" style="color: #007F7F;text-decoration: none;"> https://www.gdi-de.org</a></span><br><br>
                    </div>
                </div>
                <div class="box">
                    <div class="titlebox">
                        <span>Contact</span>
                    </div>
                    <div class="normalfont">
                        <br><span class="boldfont"> Coordination Office SDI Germany:</span><br>
                        Telefon: 069 6333-258<br>
                        Telefax: 069 6333-446<br>
                        <a href="mailto:mail@gdi-de.org" style="color: #000000; text-decoration: none;"> mail@gdi-de.org</a><br>
                        <a href="https://www.gdi-de.org" target="_blank" style="color: #000000; text-decoration: none;"> www.gdi-de.org</a><br><br>
                        <span class="boldfont"> Postal address:</span><br>
                        Coordination Office SDI Germany<br>
                        Federal Office for Cartography and Geodesy<br>
                        Richard-Strauss-Avenue 11<br>
                        60598 Frankfurt am Main, Germany<br><br>
                        <span class="boldfont"> Press contact:</span> <a href="mailto:pressekontakt@gdi-de.org" target="_blank" style="color: #000000; text-decoration: none;" >pressekontakt@gdi-de.org</a> <br><br>
                        <span class="boldfont"> Twitter:</span> <a href="https://twitter.com/gdi_de" target="_blank" style="color: #000000; text-decoration: none;">www.twitter.com/gdi_de</a> <br><br>
                    </div>
                </div>  
            </div>
        </div>

    </body>

    <!--The footer of the application-->
    <footer>
        <hr style="height: 1px; background-color: #FF0000">
        <div style="float: right;">
            <span class="footerpage">This page in [ <span style="color: #007F7F">XML</span>  ]  [<span style="color: #007F7F"> JSON </span>] </span><br>
            <span class="footertext">© 2019 - Bundesamt für Kartographie und Geodäsie, Richard-Strauss-Allee 11, 60598 Frankfurt am Main<img style="width: 25px; margin-left: 10px;" src="https://logodix.com/logo/1010052.png"></span>
        </div>
    </footer>
    </html>